# -*- mode: org; buffer-read-only: nil; truncate-lines: nil; fill-column: 84 -*-
#+STARTUP: showall
#+OPTIONS: ^:{} toc:nil num:nil date:nil author:nil
#+BIND: org-html-toplevel-hlevel 3
#+TITLE: Packer templates for Ubuntu 18 / VirtualBox

* {{{title}}}

** 概要

   このリポジトリは Ubuntu の vagrant box をビルドする環境である。
   [[https://github.com/boxcutter/ubuntu][boxcutter-ubuntu]] をフォークし、プライベート・ブランチとして育てている。

   オリジナルに対する大きな変更点:

   - ビルド工程のポリシー

     + 現時点で対応しているのは Ubuntu 18.04 のみ。

     + 対応プロバイダは virtualbox のみ。

     + システムのアップデートは行わない。

     + デスクトップ版には対応しない。

     + packer コマンドを直接タイプしてビルドする。
     ディレクトリ =bin= 以下のスクリプトおよび =Makefile= は対応修正していない。

     + 動作確認しているのはビルドのみ。
     assuer deliver clean test には対応していない。


   - VirtualBox 設定
     + EFI モード
     + チップセット ICH9
     + グラフィクス・コントローラー VMSVGA
     + HDD ストレージ・コントローラー SATA
     + ISO ストレージ・コントローラー SATA
     + 仮想CPU数 1
     + メモリ 1GB
     + ディスク容量 40GB

   - Ubuntu システム設定
     + ディスク・レイアウトは regular (LVM を使わない)
     + パーティション分割なし ( =/root= と =/boot/efi= のみ)
     + スワップなし
     + ホスト名 localhost
     + キーボードレイアウト us
     + システム・タイムゾーン UTC
     + システム・ロケール C.UTF-8
     + man と doc を削除しない
     + システムのアップデートを行わない
     + ブート時のスプラッシュを表示しない
     + ブート時の grub タイムアウト 8秒
     + VBoxGuestAdditions をインストールする


** ビルドの準備

   - ビルドを行う前に次のパッケージをインストールする。
     + VirtualBox ~=6.1.12
     + packer ~=1.6.0
     + ansible ~=2.8.10

   - インストール用 CD イメージを [[http://cdimage.ubuntu.com/ubuntu/releases/][cdimage.ubuntu]] からダウンロードしてディレクトリ 'iso' の下に置く。


** ビルド手順の例

   - box ファイルをビルドする:
     : make box.build

   - box ファイルをビルドしてから vagrant box add する:
     : make box.add

   - Vagrantfile.template から Vagrantfile を生成する。
     : make Vagrantfile
